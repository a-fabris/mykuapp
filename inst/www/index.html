<!-- index.html -->
<!doctype html>
<html>
	
<head>  
   <!-- META -->
	<meta charset="utf-8">

    <!-- JS Frameworks -->
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script> <!-- jquery -->
    <script type="text/javascript" src="bower_components/d3/d3.js"></script> <!-- d3.js data visualization -->
    <script type="text/javascript" src="bower_components/opencpu/opencpu-0.5.js"></script> <!-- open CPU -->
    

    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script> <!-- bootstrap -->
    <script type="text/javascript" src="bower_components/handsontable/dist/handsontable.full.js"></script> <!-- handsontable -->
    <script type="text/javascript" src="bower_components/papaparse/papaparse.js"></script> <!-- papa parse csv to json -->

    <!-- Angular -->
	<script type="text/javascript" src="bower_components/angular/angular.js"></script> <!-- angular.js -->
    <script type="text/javascript" src="app.js"></script> <!-- angular app definition -->
    <script type="text/javascript" src="controllers/mainController.js"></script> <!-- main controller -->

    <!-- custom JS -->
	<script type="text/javascript" src="js/plotLogic.js"></script> <!-- main controller -->    

    <!-- CSS -->
    <link rel="stylesheet" media="screen" href="bower_components/bootstrap/dist/css/bootstrap.css"><!-- bootstrap -->
    <link rel="stylesheet" media="screen" href="bower_components/font-awesome/css/font-awesome.css"><!-- font awesome -->
    <link rel="stylesheet" media="screen" href="bower_components/handsontable/dist/handsontable.full.css"><!-- handsontable -->

    <style type="text/css">
    	#data-area{ height: 350px; width: 100%; overflow: hidden;}
    	#vis-area {height: 350px; width: 100%;}
    	/*#code-area {width: 100%; height: 100%; background-color: blue;}*/
    </style>
</head>

<body ng-app="kuToR">
	<div class="container">
		<div class="row"> <!-- header -->
			<div class="span12">
				<h4>Thesis Prototype <small>Andrea Fabris</small></h4>
				<input type="file" name="csv" id="csvFile">
				<button class="btn btn-default" type="button" id="readCSV">Load table</button>
			</div>
		</div>

		<div class="row">
			<div class="span10" id="workspace"> <!-- workspace -->
				<div class="row"> 
					<div class="span12" id="vis-area"> 
					</div>
				</div>
				<div class="row">
					<div class="span12">
						<div class="row">
							<div class="span12">
								Show data table: <input type="checkbox" ng-model="checked" aria-label="Toggle ngHide"><br/>
								<div id="data-features"></div>
							</div>
						</div>
						<div class="row">
							<div class="span12" id="data-area" ng-show="checked">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="span2" id="code-area"> <!-- global transcritp -->
			</div>
		</div>
	</div>
</body>

<script>


var container = document.getElementById('data-area');

var cerealData; 

var featureSet = new Set(); //array to store the data variables

//call R function: stocks::smoothplot(ticker=ticker)
$("#plotFromR").click(function(){
    //var ticker = $("#ticker").val();

    //ocpu.seturl("https://public.opencpu.org/ocpu/library/ggplot2/R");

    var req = $("#vis-area").rplot("histogram");
    
    //optional
    req.fail(function(){
        alert("R returned an error: " + req.responseText); 
    });
});

    var hot = new Handsontable(container, {
		//startRows: 8,
    	//startCols: 6,
    	rowHeaders: true,
    	contextMenu: true,
    	customBorders: true,
		manualColumnMove: true,
    	manualRowMove: true
	});

$("#readCSV").click(function(){

	var csvFile = $("#csvFile")[0].files[0];

	Papa.parse(csvFile, {
		
		complete: function(results) {
	
			hot.updateSettings({colHeaders : results.data[0]});
	
			hot.loadData(results.data);
	
			for(var i = 0 ; i < results.data[0].length ; i++){

				var txtToAppend = "";
				txtToAppend += "<span class='label label-default'>";
				txtToAppend += "<input type='checkbox' name='checkbox' id='chk_" + results.data[0][i] + "' value='" + results.data[0][i] + "' />";
				txtToAppend += results.data[0][i];
				txtToAppend += "</span>";

				$( "#data-features" ).append( txtToAppend );
			}

   			$(document).ready(function(){
   				featureListener();
   				/*
   				$("button").click(function(event){
   					var btnId = event.target.id;
   					plotFromFeature(btnId);
   				});
				*/


			}); // .document.ready
		}			
	})

});

    function plotFromFeature(btnId){
    	
    	var myFeature = "";
    	myFeature = btnId.substring(4); // cuts btn_ prefix
    	
    	//console.log("feature from id: " + myFeature);

    	var req = $("#vis-area").rplot("histoFromFeature",{
    		feature : myFeature 
    	});
    
    	//optional
    	req.fail(function(){
			alert("R returned an error: " + req.responseText); 
		});
    }

</script>

</html>